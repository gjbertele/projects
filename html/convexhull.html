<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <style>
        body{
            position:absolute;
            left:0;
            top:0;
            width:100%;
            height:100%;
            margin:0;
        }
    </style>
    <canvas></canvas><br>
    <input><button>Regenerate</button><br>
    <span class="t"></span>
    <script>
        const canvas = document.querySelector('canvas')
        const input = document.querySelector('input')
        const button = document.querySelector('button')
        const times = document.querySelector('.t')
        const ctx = canvas.getContext('2d')
        let pts = 4000
        let ww = document.body.clientHeight*0.75
        let wh = ww
        let points = []
        canvas.width = ww >> 0
        canvas.height = wh >> 0
        function generate(){
            points = []
            for(let v = 0; v<pts; v++){
                points.push({x:Math.random()*ww>>0,y:Math.random()*wh>>0,i:v})
            }
        }
        function test(){
        let delimeter = ww/(Math.sqrt(pts))
        let topline = []
        let bottomline = []
        let temparr = points.sort((a,b) => a.y - b.y)
        let rightLine = temparr.filter(i => i.x > ww-delimeter)
        let leftLine = temparr.reverse().filter(i => i.x < delimeter)
        let avgh = points.reduce((a,b) => a + b.y)/pts
        for(let tx = 0; tx<ww/delimeter; tx++){
            let ptsTarget = points.filter(i => (i.x/delimeter)>>0 == tx)
            if(ptsTarget.length > 0){
                if(ptsTarget.length == 1){
                    if(ptsTarget[0].y < avgh){
                        bottomline.push(ptsTarget[0])
                    } else {
                        topline.push(ptsTarget[0])
                    }
                } else {
                    topline.push(ptsTarget.sort((a,b) => a.y - b.y)[0])
                    bottomline.push(ptsTarget.sort((a,b) => b.y - a.y)[0])
                }
            }
        }
        line = topline.concat(rightLine).concat(bottomline.reverse()).concat(leftLine)
        line = line.filter((i,v) => line.indexOf(i) == v)
    }
    button.onclick = function(){
        pts = input.value
        ctx.clearRect(0,0,ww,wh)
    generate()
    let t = performance.now()
    test()
    let td = performance.now()-t
        ctx.beginPath()
        for(let v = 0; v<points.length; v++){
            let i = points[v]
            ctx.fillRect(i.x,i.y,3,3)
        }
        ctx.strokeStyle = '#FF0000'
        ctx.lineWidth = '15px'
        for(let v = 0; v<line.length; v++){
            let pt = line[v]
            ctx.lineTo(pt.x,pt.y)
        }
        ctx.lineTo(line[0].x,line[0].y)
        ctx.stroke()
        times.textContent = td+'ms'
    }


    

    </script>
</body>
</html>